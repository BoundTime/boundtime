-- Tabelle für deutsche PLZ und Orte (nur gültige Kombinationen für Profil-Ort)
create table public.plz_orte (
  id bigint generated always as identity primary key,
  plz text not null check (char_length(plz) = 5 and plz ~ '^\d{5}$'),
  ort text not null,
  bundesland text
);

create index plz_orte_plz_idx on public.plz_orte (plz);
create index plz_orte_ort_idx on public.plz_orte (ort text_pattern_ops);
comment on table public.plz_orte is 'Deutsche Postleitzahlen und Orte für Autocomplete; Quelle: offene Daten (z.B. suche-postleitzahl.org).';

alter table public.plz_orte enable row level security;

-- Alle dürfen lesen (für Autocomplete), niemand schreibt über die App
create policy "plz_orte_select" on public.plz_orte for select using (true);

-- Beispieldaten (Auszug Deutschland); vollständige Liste z.B. über CSV-Import (zuordnung_plz_ort.csv)
insert into public.plz_orte (plz, ort, bundesland) values
('10115','Berlin','Berlin'),('10178','Berlin','Berlin'),('10243','Berlin','Berlin'),('10365','Berlin','Berlin'),('10405','Berlin','Berlin'),('10551','Berlin','Berlin'),('10707','Berlin','Berlin'),('10961','Berlin','Berlin'),('12043','Berlin','Berlin'),('12157','Berlin','Berlin'),('12277','Berlin','Berlin'),('12351','Berlin','Berlin'),('12435','Berlin','Berlin'),('12524','Berlin','Berlin'),('12619','Berlin','Berlin'),('13051','Berlin','Berlin'),('13156','Berlin','Berlin'),('13347','Berlin','Berlin'),('13403','Berlin','Berlin'),('13581','Berlin','Berlin'),('14050','Berlin','Berlin'),('14129','Berlin','Berlin'),('14163','Berlin','Berlin'),
('20095','Hamburg','Hamburg'),('20099','Hamburg','Hamburg'),('20144','Hamburg','Hamburg'),('20249','Hamburg','Hamburg'),('20354','Hamburg','Hamburg'),('20457','Hamburg','Hamburg'),('20535','Hamburg','Hamburg'),('21073','Hamburg','Hamburg'),('22041','Hamburg','Hamburg'),('22111','Hamburg','Hamburg'),('22301','Hamburg','Hamburg'),('22391','Hamburg','Hamburg'),('22415','Hamburg','Hamburg'),('22525','Hamburg','Hamburg'),('22605','Hamburg','Hamburg'),('22761','Hamburg','Hamburg'),
('80331','München','Bayern'),('80333','München','Bayern'),('80469','München','Bayern'),('80538','München','Bayern'),('80634','München','Bayern'),('80636','München','Bayern'),('80796','München','Bayern'),('80801','München','Bayern'),('80802','München','Bayern'),('80803','München','Bayern'),('80804','München','Bayern'),('80805','München','Bayern'),('80807','München','Bayern'),('80933','München','Bayern'),('80935','München','Bayern'),('80937','München','Bayern'),('80939','München','Bayern'),('80992','München','Bayern'),('81241','München','Bayern'),('81243','München','Bayern'),('81245','München','Bayern'),('81247','München','Bayern'),('81249','München','Bayern'),
('50667','Köln','Nordrhein-Westfalen'),('50668','Köln','Nordrhein-Westfalen'),('50670','Köln','Nordrhein-Westfalen'),('50672','Köln','Nordrhein-Westfalen'),('50674','Köln','Nordrhein-Westfalen'),('50676','Köln','Nordrhein-Westfalen'),('50677','Köln','Nordrhein-Westfalen'),('50678','Köln','Nordrhein-Westfalen'),('50679','Köln','Nordrhein-Westfalen'),('50733','Köln','Nordrhein-Westfalen'),('50735','Köln','Nordrhein-Westfalen'),('50737','Köln','Nordrhein-Westfalen'),('50739','Köln','Nordrhein-Westfalen'),('50823','Köln','Nordrhein-Westfalen'),('50825','Köln','Nordrhein-Westfalen'),('50827','Köln','Nordrhein-Westfalen'),('50829','Köln','Nordrhein-Westfalen'),('50858','Köln','Nordrhein-Westfalen'),('50931','Köln','Nordrhein-Westfalen'),('50933','Köln','Nordrhein-Westfalen'),('50935','Köln','Nordrhein-Westfalen'),('50937','Köln','Nordrhein-Westfalen'),('50939','Köln','Nordrhein-Westfalen'),('50968','Köln','Nordrhein-Westfalen'),('50969','Köln','Nordrhein-Westfalen'),('50996','Köln','Nordrhein-Westfalen'),('50997','Köln','Nordrhein-Westfalen'),('50999','Köln','Nordrhein-Westfalen'),
('60308','Frankfurt am Main','Hessen'),('60311','Frankfurt am Main','Hessen'),('60313','Frankfurt am Main','Hessen'),('60314','Frankfurt am Main','Hessen'),('60316','Frankfurt am Main','Hessen'),('60318','Frankfurt am Main','Hessen'),('60320','Frankfurt am Main','Hessen'),('60322','Frankfurt am Main','Hessen'),('60325','Frankfurt am Main','Hessen'),('60326','Frankfurt am Main','Hessen'),('60327','Frankfurt am Main','Hessen'),('60329','Frankfurt am Main','Hessen'),('60431','Frankfurt am Main','Hessen'),('60433','Frankfurt am Main','Hessen'),('60435','Frankfurt am Main','Hessen'),('60437','Frankfurt am Main','Hessen'),('60438','Frankfurt am Main','Hessen'),('60439','Frankfurt am Main','Hessen'),('60486','Frankfurt am Main','Hessen'),('60487','Frankfurt am Main','Hessen'),('60488','Frankfurt am Main','Hessen'),('60489','Frankfurt am Main','Hessen'),('60528','Frankfurt am Main','Hessen'),('60529','Frankfurt am Main','Hessen'),('60549','Frankfurt am Main','Hessen'),('60594','Frankfurt am Main','Hessen'),('60596','Frankfurt am Main','Hessen'),('60598','Frankfurt am Main','Hessen'),('60599','Frankfurt am Main','Hessen'),
('70173','Stuttgart','Baden-Württemberg'),('70174','Stuttgart','Baden-Württemberg'),('70176','Stuttgart','Baden-Württemberg'),('70178','Stuttgart','Baden-Württemberg'),('70180','Stuttgart','Baden-Württemberg'),('70182','Stuttgart','Baden-Württemberg'),('70184','Stuttgart','Baden-Württemberg'),('70186','Stuttgart','Baden-Württemberg'),('70188','Stuttgart','Baden-Württemberg'),('70190','Stuttgart','Baden-Württemberg'),('70191','Stuttgart','Baden-Württemberg'),('70192','Stuttgart','Baden-Württemberg'),('70193','Stuttgart','Baden-Württemberg'),('70195','Stuttgart','Baden-Württemberg'),('70197','Stuttgart','Baden-Württemberg'),('70199','Stuttgart','Baden-Württemberg'),('70327','Stuttgart','Baden-Württemberg'),('70329','Stuttgart','Baden-Württemberg'),('70372','Stuttgart','Baden-Württemberg'),('70374','Stuttgart','Baden-Württemberg'),('70376','Stuttgart','Baden-Württemberg'),('70378','Stuttgart','Baden-Württemberg'),
('40210','Düsseldorf','Nordrhein-Westfalen'),('40211','Düsseldorf','Nordrhein-Westfalen'),('40212','Düsseldorf','Nordrhein-Westfalen'),('40213','Düsseldorf','Nordrhein-Westfalen'),('40215','Düsseldorf','Nordrhein-Westfalen'),('40217','Düsseldorf','Nordrhein-Westfalen'),('40219','Düsseldorf','Nordrhein-Westfalen'),('40221','Düsseldorf','Nordrhein-Westfalen'),('40223','Düsseldorf','Nordrhein-Westfalen'),('40225','Düsseldorf','Nordrhein-Westfalen'),('40227','Düsseldorf','Nordrhein-Westfalen'),('40229','Düsseldorf','Nordrhein-Westfalen'),('40231','Düsseldorf','Nordrhein-Westfalen'),('40233','Düsseldorf','Nordrhein-Westfalen'),('40235','Düsseldorf','Nordrhein-Westfalen'),('40237','Düsseldorf','Nordrhein-Westfalen'),('40239','Düsseldorf','Nordrhein-Westfalen'),('40468','Düsseldorf','Nordrhein-Westfalen'),('40470','Düsseldorf','Nordrhein-Westfalen'),('40472','Düsseldorf','Nordrhein-Westfalen'),('40474','Düsseldorf','Nordrhein-Westfalen'),('40476','Düsseldorf','Nordrhein-Westfalen'),('40477','Düsseldorf','Nordrhein-Westfalen'),('40479','Düsseldorf','Nordrhein-Westfalen'),('40489','Düsseldorf','Nordrhein-Westfalen'),('40545','Düsseldorf','Nordrhein-Westfalen'),('40547','Düsseldorf','Nordrhein-Westfalen'),('40549','Düsseldorf','Nordrhein-Westfalen'),('40589','Düsseldorf','Nordrhein-Westfalen'),('40591','Düsseldorf','Nordrhein-Westfalen'),('40593','Düsseldorf','Nordrhein-Westfalen'),('40595','Düsseldorf','Nordrhein-Westfalen'),('40597','Düsseldorf','Nordrhein-Westfalen'),('40599','Düsseldorf','Nordrhein-Westfalen'),
('44135','Dortmund','Nordrhein-Westfalen'),('44137','Dortmund','Nordrhein-Westfalen'),('44139','Dortmund','Nordrhein-Westfalen'),('44141','Dortmund','Nordrhein-Westfalen'),('44143','Dortmund','Nordrhein-Westfalen'),('44145','Dortmund','Nordrhein-Westfalen'),('44147','Dortmund','Nordrhein-Westfalen'),('44149','Dortmund','Nordrhein-Westfalen'),('44225','Dortmund','Nordrhein-Westfalen'),('44227','Dortmund','Nordrhein-Westfalen'),('44229','Dortmund','Nordrhein-Westfalen'),('44263','Dortmund','Nordrhein-Westfalen'),('44265','Dortmund','Nordrhein-Westfalen'),('44267','Dortmund','Nordrhein-Westfalen'),('44269','Dortmund','Nordrhein-Westfalen'),('44287','Dortmund','Nordrhein-Westfalen'),('44289','Dortmund','Nordrhein-Westfalen'),('44309','Dortmund','Nordrhein-Westfalen'),('44319','Dortmund','Nordrhein-Westfalen'),('44328','Dortmund','Nordrhein-Westfalen'),('44329','Dortmund','Nordrhein-Westfalen'),('44339','Dortmund','Nordrhein-Westfalen'),('44357','Dortmund','Nordrhein-Westfalen'),('44359','Dortmund','Nordrhein-Westfalen'),('44369','Dortmund','Nordrhein-Westfalen'),('44379','Dortmund','Nordrhein-Westfalen'),('44388','Dortmund','Nordrhein-Westfalen'),('44389','Dortmund','Nordrhein-Westfalen'),
('45127','Essen','Nordrhein-Westfalen'),('45128','Essen','Nordrhein-Westfalen'),('45130','Essen','Nordrhein-Westfalen'),('45131','Essen','Nordrhein-Westfalen'),('45133','Essen','Nordrhein-Westfalen'),('45134','Essen','Nordrhein-Westfalen'),('45136','Essen','Nordrhein-Westfalen'),('45138','Essen','Nordrhein-Westfalen'),('45139','Essen','Nordrhein-Westfalen'),('45141','Essen','Nordrhein-Westfalen'),('45143','Essen','Nordrhein-Westfalen'),('45144','Essen','Nordrhein-Westfalen'),('45145','Essen','Nordrhein-Westfalen'),('45147','Essen','Nordrhein-Westfalen'),('45149','Essen','Nordrhein-Westfalen'),('45159','Essen','Nordrhein-Westfalen'),('45219','Essen','Nordrhein-Westfalen'),('45239','Essen','Nordrhein-Westfalen'),('45257','Essen','Nordrhein-Westfalen'),('45259','Essen','Nordrhein-Westfalen'),('45276','Essen','Nordrhein-Westfalen'),('45277','Essen','Nordrhein-Westfalen'),('45279','Essen','Nordrhein-Westfalen'),('45289','Essen','Nordrhein-Westfalen'),('45307','Essen','Nordrhein-Westfalen'),('45309','Essen','Nordrhein-Westfalen'),('45326','Essen','Nordrhein-Westfalen'),('45327','Essen','Nordrhein-Westfalen'),('45329','Essen','Nordrhein-Westfalen'),('45355','Essen','Nordrhein-Westfalen'),('45356','Essen','Nordrhein-Westfalen'),('45357','Essen','Nordrhein-Westfalen'),('45359','Essen','Nordrhein-Westfalen'),
('04103','Leipzig','Sachsen'),('04105','Leipzig','Sachsen'),('04107','Leipzig','Sachsen'),('04109','Leipzig','Sachsen'),('04129','Leipzig','Sachsen'),('04155','Leipzig','Sachsen'),('04157','Leipzig','Sachsen'),('04159','Leipzig','Sachsen'),('04177','Leipzig','Sachsen'),('04179','Leipzig','Sachsen'),('04205','Leipzig','Sachsen'),('04207','Leipzig','Sachsen'),('04209','Leipzig','Sachsen'),('04229','Leipzig','Sachsen'),('04249','Leipzig','Sachsen'),('04275','Leipzig','Sachsen'),('04277','Leipzig','Sachsen'),('04279','Leipzig','Sachsen'),('04288','Leipzig','Sachsen'),('04289','Leipzig','Sachsen'),('04299','Leipzig','Sachsen'),('04315','Leipzig','Sachsen'),('04316','Leipzig','Sachsen'),('04317','Leipzig','Sachsen'),('04318','Leipzig','Sachsen'),('04319','Leipzig','Sachsen'),('04329','Leipzig','Sachsen'),('04347','Leipzig','Sachsen'),('04349','Leipzig','Sachsen'),('04357','Leipzig','Sachsen'),
('01067','Dresden','Sachsen'),('01069','Dresden','Sachsen'),('01097','Dresden','Sachsen'),('01099','Dresden','Sachsen'),('01108','Dresden','Sachsen'),('01109','Dresden','Sachsen'),('01127','Dresden','Sachsen'),('01129','Dresden','Sachsen'),('01139','Dresden','Sachsen'),('01156','Dresden','Sachsen'),('01157','Dresden','Sachsen'),('01159','Dresden','Sachsen'),('01169','Dresden','Sachsen'),('01187','Dresden','Sachsen'),('01189','Dresden','Sachsen'),('01217','Dresden','Sachsen'),('01219','Dresden','Sachsen'),('01237','Dresden','Sachsen'),('01239','Dresden','Sachsen'),('01257','Dresden','Sachsen'),('01259','Dresden','Sachsen'),('01277','Dresden','Sachsen'),('01279','Dresden','Sachsen'),('01307','Dresden','Sachsen'),('01309','Dresden','Sachsen'),('01324','Dresden','Sachsen'),('01326','Dresden','Sachsen'),('01328','Dresden','Sachsen'),
('30159','Hannover','Niedersachsen'),('30161','Hannover','Niedersachsen'),('30163','Hannover','Niedersachsen'),('30165','Hannover','Niedersachsen'),('30167','Hannover','Niedersachsen'),('30169','Hannover','Niedersachsen'),('30171','Hannover','Niedersachsen'),('30173','Hannover','Niedersachsen'),('30175','Hannover','Niedersachsen'),('30177','Hannover','Niedersachsen'),('30179','Hannover','Niedersachsen'),('30419','Hannover','Niedersachsen'),('30449','Hannover','Niedersachsen'),('30451','Hannover','Niedersachsen'),('30453','Hannover','Niedersachsen'),('30455','Hannover','Niedersachsen'),('30457','Hannover','Niedersachsen'),('30459','Hannover','Niedersachsen'),('30519','Hannover','Niedersachsen'),('30521','Hannover','Niedersachsen'),('30539','Hannover','Niedersachsen'),('30559','Hannover','Niedersachsen'),
('99084','Erfurt','Thüringen'),('99085','Erfurt','Thüringen'),('99086','Erfurt','Thüringen'),('99087','Erfurt','Thüringen'),('99089','Erfurt','Thüringen'),('99091','Erfurt','Thüringen'),('99092','Erfurt','Thüringen'),('99094','Erfurt','Thüringen'),('99096','Erfurt','Thüringen'),('99097','Erfurt','Thüringen'),('99098','Erfurt','Thüringen'),('99099','Erfurt','Thüringen'),
('66111','Saarbrücken','Saarland'),('66113','Saarbrücken','Saarland'),('66115','Saarbrücken','Saarland'),('66117','Saarbrücken','Saarland'),('66119','Saarbrücken','Saarland'),('66121','Saarbrücken','Saarland'),('66123','Saarbrücken','Saarland'),('66125','Saarbrücken','Saarland'),('66126','Saarbrücken','Saarland'),('66127','Saarbrücken','Saarland'),('66128','Saarbrücken','Saarland'),('66129','Saarbrücken','Saarland'),('66130','Saarbrücken','Saarland'),('66131','Saarbrücken','Saarland'),('66132','Saarbrücken','Saarland'),('66133','Saarbrücken','Saarland'),
('55116','Mainz','Rheinland-Pfalz'),('55118','Mainz','Rheinland-Pfalz'),('55120','Mainz','Rheinland-Pfalz'),('55122','Mainz','Rheinland-Pfalz'),('55124','Mainz','Rheinland-Pfalz'),('55126','Mainz','Rheinland-Pfalz'),('55127','Mainz','Rheinland-Pfalz'),('55128','Mainz','Rheinland-Pfalz'),('55129','Mainz','Rheinland-Pfalz'),('55130','Mainz','Rheinland-Pfalz'),('55131','Mainz','Rheinland-Pfalz'),
('39104','Magdeburg','Sachsen-Anhalt'),('39106','Magdeburg','Sachsen-Anhalt'),('39108','Magdeburg','Sachsen-Anhalt'),('39110','Magdeburg','Sachsen-Anhalt'),('39112','Magdeburg','Sachsen-Anhalt'),('39114','Magdeburg','Sachsen-Anhalt'),('39116','Magdeburg','Sachsen-Anhalt'),('39118','Magdeburg','Sachsen-Anhalt'),('39120','Magdeburg','Sachsen-Anhalt'),('39122','Magdeburg','Sachsen-Anhalt'),('39124','Magdeburg','Sachsen-Anhalt'),('39126','Magdeburg','Sachsen-Anhalt'),('39128','Magdeburg','Sachsen-Anhalt'),('39130','Magdeburg','Sachsen-Anhalt'),
('24103','Kiel','Schleswig-Holstein'),('24105','Kiel','Schleswig-Holstein'),('24106','Kiel','Schleswig-Holstein'),('24107','Kiel','Schleswig-Holstein'),('24109','Kiel','Schleswig-Holstein'),('24111','Kiel','Schleswig-Holstein'),('24113','Kiel','Schleswig-Holstein'),('24114','Kiel','Schleswig-Holstein'),('24116','Kiel','Schleswig-Holstein'),('24118','Kiel','Schleswig-Holstein'),('24143','Kiel','Schleswig-Holstein'),('24145','Kiel','Schleswig-Holstein'),('24146','Kiel','Schleswig-Holstein'),('24147','Kiel','Schleswig-Holstein'),('24149','Kiel','Schleswig-Holstein'),('24159','Kiel','Schleswig-Holstein');
